<source>
  @type  forward
  @id    input1
  @label @mainstream
  port {{ var "LISTEN_PORT" | default "24224" }}
</source>

<label @mainstream>
  <filter docker.log-generator.**>
    @type parser
    format /^(?<remote>[^ ]*) (?<host>[^ ]*) (?<user>[^ ]*) \[(?<time>[^\]]*)\] "(?<method>\S+)(?: +(?<path>[^ ]*) +\S*)?" (?<code>[^ ]*) (?<size>[^ ]*)(?: "(?<referer>[^\"]*)" "(?<agent>[^\"]*)" "(?<forwarder>[^\"]*)")?/
    time_format %d/%b/%Y:%H:%M:%S %z
    key_name log
  </filter>
  
  <match docker.**>
    @type elasticsearch_dynamic
    host elasticsearch
    port 9200
    time_key time

    type_name ${tag_parts[0]}.${tag_parts[1]}
    logstash_format true
    logstash_prefix exam05c
    flush_interval 5
  </match>
  
  <match **>
    @type file
    @id   output1
    path         /fluentd/log/data.*.log
    symlink_path /fluentd/log/data.log
    append       true
    time_slice_format %Y%m%d
    time_slice_wait   10m
    time_format       %Y%m%dT%H%M%S%z
  </match>
</label>

<match fluent.**>
  @type file
  @id   output2
  path         /fluentd/log/fluentd/errors.*.log
  symlink_path /fluentd/log/fluentd/errors.log
  append       true
  time_slice_format %Y%m%d
  time_slice_wait   10m
  time_format %d/%b/%Y:%H:%M:%S%z
</match>
